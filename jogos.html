<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zombie Arena - Especial</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
html, body { margin:0; padding:0; overflow:hidden; background:#111; font-family:'Press Start 2P', monospace; }
canvas { display:block; width:100vw; height:100vh; touch-action:none; }
#restartBtn {
  position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
  font-size:24px; padding:15px 30px; background:#ff3333; color:white;
  border:none; border-radius:10px; cursor:pointer; display:none;
}
#loveText {
  position:absolute; top:calc(50% + 60px); left:50%; transform:translateX(-50%);
  color:#ff77ff; font-size:16px; text-align:center; text-shadow:0 0 8px #ff00ff; display:none;
}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<button id="restartBtn">Reiniciar</button>
<div id="loveText"> BENI TEU PAI E O MELHOR ❤️</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const restartBtn = document.getElementById('restartBtn');
const loveText = document.getElementById('loveText');

function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// === ESCALAS ===
const scale = (35 / 288) * 2.5;       
const playerScale = (35 / 288) * 3.5;

// === OFFSETS DA PONTA DA ARMA ===
let bulletOffsetX = 35; 
let bulletOffsetY = 20; 

// Sprites
let zombieFrames = [], playerFrames = [], shootFrames = [], meleeFrames = [];

// GAME STATE
let player, bullets, zombies, particles, lives, kills, spawnTimer, gameOver;
let ammo=6, maxAmmo=6, reloading=false, reloadTime=2000;
let specialUnlocked=false, specialShotsLeft=50;
let damageFlash=0;
let mouse={x:0,y:0};
const keys={};
let damageCooldown=0;

// === CONTROLES ===
window.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
window.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);
window.addEventListener('mousemove', e=>mouse={x:e.clientX, y:e.clientY});
window.addEventListener('mousedown', shoot);

// === CARREGAMENTO DAS IMAGENS ===
function loadImages(paths, callback){
    let loaded=0, imgs=[];
    for(let i=0;i<paths.length;i++){
        const img=new Image();
        img.src=paths[i];
        img.onload = () => { loaded++; if(loaded===paths.length) callback(imgs); };
        imgs.push(img);
    }
}

// Caminhos das imagens
const zombiePaths = []; for(let i=0;i<=16;i++) zombiePaths.push(`skeleton-move_${i}.png`);
const playerPaths = []; for(let i=0;i<=19;i++) playerPaths.push(`survivor-move_shotgun_${i}.png`);
const shootPaths = []; for(let i=0;i<=2;i++) shootPaths.push(`survivor-shoot_shotgun_${i}.png`);
const meleePaths = []; for(let i=0;i<=14;i++) meleePaths.push(`survivor-meleeattack_shotgun_${i}.png`);

loadImages(zombiePaths, imgs=>{
    zombieFrames.push(...imgs);
    loadImages(playerPaths, imgs2=>{
        playerFrames.push(...imgs2);
        loadImages(shootPaths, imgs3=>{
            shootFrames.push(...imgs3);
            loadImages(meleePaths, imgs4=>{
                meleeFrames.push(...imgs4);
                resetGame();
                gameLoop();
            });
        });
    });
});

// === FUNÇÕES ===
function resetGame(){
    player={x:canvas.width/2,y:canvas.height/2,size:40,speed:4,angle:0,frame:0,frameTimer:0,
            shooting:false,shootFrame:0,shootTimer:0,meleeing:false,meleeFrame:0,meleeTimer:0};
    bullets=[]; zombies=[]; particles=[]; lives=3; kills=0; spawnTimer=0; gameOver=false;
    ammo=maxAmmo; reloading=false; specialUnlocked=false; specialShotsLeft=50;
    damageFlash=0; damageCooldown=0;
    restartBtn.style.display='none'; loveText.style.display='none';
}

function shoot(){
    if(reloading || ammo<=0 || gameOver) return;
    const angle=Math.atan2(mouse.y-player.y, mouse.x-player.x);
    const bulletX = player.x + bulletOffsetX*Math.cos(angle) - bulletOffsetY*Math.sin(angle);
    const bulletY = player.y + bulletOffsetX*Math.sin(angle) + bulletOffsetY*Math.cos(angle);
    bullets.push({x:bulletX,y:bulletY,dx:Math.cos(angle)*10,dy:Math.sin(angle)*10,size:6,special:specialUnlocked});
    ammo--; if(specialUnlocked) specialShotsLeft--;
    player.shooting=true; player.shootFrame=0; player.shootTimer=0;
    // Partículas de fogo na ponta da arma
    for(let i=0;i<4;i++){
        const angleOffset = (Math.random()-0.5)*0.5;
        const speed = Math.random()*2+1;
        particles.push({x:bulletX,y:bulletY,dx:Math.cos(angle+angleOffset)*speed,dy:Math.sin(angle+angleOffset)*speed,life:10,size:2});
    }
    if(ammo<=0){ reloading=true; setTimeout(()=>{ ammo=maxAmmo; reloading=false; }, reloadTime); }
    if(specialUnlocked && specialShotsLeft<=0){ specialUnlocked=false; specialShotsLeft=50; }
}

function movePlayer(){
    if(player.meleeing) return; // para quando empurrando
    let dx=0,dy=0;
    if(keys['w']) dy-=player.speed;
    if(keys['s']) dy+=player.speed;
    if(keys['a']) dx-=player.speed;
    if(keys['d']) dx+=player.speed;
    const len=Math.hypot(dx,dy);
    if(len>0){ dx/=len; dy/=len; dx*=player.speed; dy*=player.speed; }
    player.x+=dx; player.y+=dy;
    player.x=Math.max(player.size/2, Math.min(canvas.width-player.size/2, player.x));
    player.y=Math.max(player.size/2, Math.min(canvas.height-player.size/2, player.y));
    player.angle=Math.atan2(mouse.y-player.y, mouse.x-player.x);
}

function spawnZombie(){
    const side=Math.floor(Math.random()*4), offset=50; let x,y;
    if(side===0){ x=Math.random()*canvas.width; y=-offset; }
    else if(side===1){ x=canvas.width+offset; y=Math.random()*canvas.height; }
    else if(side===2){ x=Math.random()*canvas.width; y=canvas.height+offset; }
    else{ x=-offset; y=Math.random()*canvas.height; }
    zombies.push({x,y,size:35,speed:1.2,frame:0,frameTimer:0,angle:0, pushX:0, pushY:0, pushTimer:0});
}

function updateBullets(){
    for(let i=bullets.length-1;i>=0;i--){
        const b=bullets[i]; b.x+=b.dx; b.y+=b.dy;
        if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height) bullets.splice(i,1);
    }
}

function updateParticles(){
    for(let i=particles.length-1;i>=0;i--){
        const p=particles[i]; p.x+=p.dx; p.y+=p.dy; p.life--; if(p.life<=0) particles.splice(i,1);
    }
}

function spawnParticles(x,y,count=8){
    for(let i=0;i<count;i++){
        const angle=Math.random()*Math.PI*2; const speed=Math.random()*4+1;
        particles.push({x,y,dx:Math.cos(angle)*speed,dy:Math.sin(angle)*speed,life:20,size:4});
    }
}

function updateZombies(){
    for(let i=0;i<zombies.length;i++){
        const z=zombies[i];

        // Empurrão suave
        if(z.pushTimer > 0){
            z.x += z.pushX;
            z.y += z.pushY;
            z.pushTimer--;
        } else {
            const dx=player.x-z.x, dy=player.y-z.y;
            const len=Math.hypot(dx,dy);
            z.angle=Math.atan2(dy,dx);
            z.x+=dx/len*z.speed; z.y+=dy/len*z.speed;
        }

        // Repulsão entre zumbis
        for(let j=i+1;j<zombies.length;j++){
            const b=zombies[j];
            const dx2=b.x-z.x, dy2=b.y-z.y;
            const dist=Math.hypot(dx2,dy2);
            const minDist=(z.size+b.size)/2;
            if(dist<minDist && dist>0){
                const overlap=(minDist-dist)/2;
                const nx=dx2/dist, ny=dy2/dist;
                z.x-=nx*overlap*0.5; z.y-=ny*overlap*0.5;
                b.x+=nx*overlap*0.5; b.y+=ny*overlap*0.5;
            }
        }

        z.frameTimer++; if(z.frameTimer%6===0){ z.frame++; if(z.frame>=zombieFrames.length) z.frame=0; }
    }
}

function checkCollisions(){
    if(damageCooldown>0) damageCooldown--;

    // Bullets vs zombies
    for(let i=bullets.length-1;i>=0;i--){
        const b=bullets[i];
        for(let j=zombies.length-1;j>=0;j--){
            const z=zombies[j]; const dx=b.x-z.x, dy=b.y-z.y;
            if(Math.hypot(dx,dy)<z.size/2){ spawnParticles(z.x,z.y,6); zombies.splice(j,1); if(!b.special) bullets.splice(i,1); kills++; if(kills>=15) specialUnlocked=true; break; }
        }
    }

    // Player vs zombies
    for(let z of zombies){
        const dx=z.x-player.x, dy=z.y-player.y;
        const dist=Math.hypot(dx,dy);
        const minDist=(player.size+z.size)/2;
        if(dist<minDist && damageCooldown<=0){
            // Dano
            lives--; damageFlash=5; damageCooldown=60;
            if(lives<=0) endGame();

            // Empurrão suave do zumbi
            player.meleeing=true; player.meleeFrame=0; player.meleeTimer=0;
            const pushDist = minDist - dist + 40;
            const pushSteps = 12; // quantidade de frames para deslizar
            z.pushX = (dx/dist) * (pushDist / pushSteps);
            z.pushY = (dy/dist) * (pushDist / pushSteps);
            z.pushTimer = pushSteps;
        }
    }
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(damageFlash>0){
        ctx.fillStyle='rgba(255,0,0,0.3)';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        damageFlash--;
    }

    bullets.forEach(b=>{ ctx.beginPath(); ctx.arc(b.x,b.y,b.size,0,Math.PI*2); ctx.fillStyle=b.special?'red':'#ffcc00'; ctx.fill(); });
    particles.forEach(p=>{ ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fillStyle='orange'; ctx.fill(); });

    zombies.forEach(z=>{
        const img=zombieFrames[z.frame];
        ctx.save(); ctx.translate(z.x,z.y); ctx.rotate(z.angle);
        ctx.drawImage(img,-img.width/2*scale,-img.height/2*scale,img.width*scale,img.height*scale);
        ctx.restore();
    });

    let imgPlayer;
    if(player.meleeing){
        player.meleeTimer++;
        if(player.meleeTimer%3===0){ player.meleeFrame++; if(player.meleeFrame>=meleeFrames.length){ player.meleeing=false; player.meleeFrame=0; } }
        imgPlayer = meleeFrames[player.meleeFrame];
    } else if(player.shooting){
        player.shootTimer++; if(player.shootTimer%3===0){ player.shootFrame++; if(player.shootFrame>=shootFrames.length){ player.shooting=false; player.shootFrame=0; } }
        imgPlayer = shootFrames[player.shootFrame];
    } else {
        player.frameTimer++; if(player.frameTimer%6===0){ player.frame++; if(player.frame>=playerFrames.length) player.frame=0; }
        imgPlayer = playerFrames[player.frame];
    }

    ctx.save(); ctx.translate(player.x,player.y); ctx.rotate(player.angle);
    ctx.drawImage(imgPlayer,-imgPlayer.width/2*playerScale,-imgPlayer.height/2*playerScale,imgPlayer.width*playerScale,imgPlayer.height*playerScale);
    ctx.restore();

    ctx.fillStyle='#fff'; ctx.font='20px Arial';
    ctx.fillText(`❤️ Vidas: ${lives}`,20,40);
    ctx.fillText(`🔫 Balas: ${ammo}/${maxAmmo}`,20,70);
    ctx.fillText(`💀 Zumbis mortos: ${kills}`,20,100);
    if(reloading){ ctx.fillStyle='orange'; ctx.fillText('Recarregando...',20,130); }
    if(specialUnlocked){ ctx.fillStyle='red'; ctx.fillText(`Arma Especial: ${specialShotsLeft} tiros`,20,160); }

    if(gameOver){
        ctx.fillStyle='red'; ctx.font='32px "Press Start 2P"';
        ctx.textAlign='center';
        ctx.fillText('GAME OVER',canvas.width/2,canvas.height/2-50);
        loveText.style.display='block';
    }
}

function gameLoop(){
    if(!gameOver){
        movePlayer();
        updateBullets();
        updateZombies();
        updateParticles();
        checkCollisions();
        spawnTimer++;
        if(spawnTimer%60===0) spawnZombie();
    }
    draw();
    requestAnimationFrame(gameLoop);
}

function endGame(){ gameOver=true; restartBtn.style.display='block'; }

restartBtn.addEventListener('click', resetGame);
</script>
</body>
</html>
